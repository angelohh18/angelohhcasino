<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="mobile-web-app-capable" content="yes" />
<meta name="theme-color" content="#c5a56a" />
<meta name="apple-mobile-web-app-title" content="La 51 - UPDATED" />
<!-- Force Render Update: 2024-12-19 -->
<!-- TEST VISIBLE: Si ves este comentario, Render está actualizado -->
<!-- CACHE BUST: HTML actualizado - 2024-12-19 15:30 -->
<!-- TEST DEPLOY: Media queries completas implementadas -->
<meta name="application-name" content="La 51" />
<meta name="msapplication-TileColor" content="#211e18" />
<meta name="msapplication-tap-highlight" content="no" />

<!-- PWA Manifest -->
<link rel="manifest" href="/ludo/manifest.json">

<!-- Favicon e iconos -->
<link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png">
<link rel="icon" type="image/png" sizes="512x512" href="/icon-512.png">
<link rel="icon" type="image/png" sizes="144x144" href="/icon-144.png">
<link rel="apple-touch-icon" href="/icon-192.png">

<title>Ludo</title>
<link rel="stylesheet" href="/ludo/ludostyle.css?v=12">
</head>
<body>

<div id="orientation-message">
  <div>
    <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-bottom: 20px;"><path d="M16.4 3.6a9 9 0 0 1 0 16.8M3.6 7.6a9 9 0 0 1 16.8 0"/><path d="M21 16H3M21 8H3"/></svg>
    <p>Por favor, gira tu dispositivo a la posición horizontal para continuar.</p>
  </div>
</div>

<div id="lobby-overlay" class="overlay" role="dialog" aria-modal="true" aria-labelledby="lobby-title" style="display: none;">
  <div class="overlay-content">
    
    <div class="lobby-main" role="main">
    <section class="user-panel" aria-label="Panel de usuario">
      <h2 class="panel-title">
        <span class="dice left-dice"></span>
        <span class="char" style="--i:1">L</span>
        <span class="char" style="--i:2">U</span>
        <span class="char" style="--i:3">D</span>
        <span class="char" style="--i:4">O</span>
        <span class="char" style="--i:5"> </span>
        <span class="char" style="--i:6">Y</span>
        <span class="char" style="--i:7"> </span>
        <span class="char" style="--i:8">P</span>
        <span class="char" style="--i:9">A</span>
        <span class="char" style="--i:10">R</span>
        <span class="char" style="--i:11">C</span>
        <span class="char" style="--i:12">H</span>
        <span class="char" style="--i:13">Í</span>
        <span class="char" style="--i:14">S</span>
        <span class="dice right-dice"></span>
      </h2>
      <div>
        <div class="avatar-container">
          <img src="" alt="Avatar del usuario" class="avatar" id="user-avatar" />
          <label for="avatar-input" class="avatar-label" title="Cambiar avatar">✎</label>
          <input type="file" id="avatar-input" accept="image/*" aria-label="Seleccionar avatar" />
        </div>
        <div class="username" id="user-name">Invitado</div>
        <div class="credits" id="user-credits">Créditos 0</div>
        
        <button class="button orange" id="btn-change-password">Cambiar Contraseña</button>
        <button class="button orange" id="btn-rules">Reglas del Juego</button>
        <button class="button orange" id="btn-reload-credits">Recargar/Retirar Créditos</button>
      </div>
      <div class="user-actions">
        <button class="button secondary" onclick="window.location.href='/select'">Cambiar de Juego</button>
        <button class="button secondary" id="btn-logout">Cerrar Sesión</button>
      </div>
    </section>
    <section class="tables-panel" id="rooms-overview" aria-label="Mesas disponibles" tabindex="0">
    </section>
    <section class="chat-panel" aria-label="Chat de la sala">
        <div class="chat-header">Chat Sala</div>
        
        <div class="online-users">
            <h4 class="online-users-title">Jugadores Conectados</h4>
            <ul id="online-users-list">
            </ul>
        </div>
        
        <div class="chat-messages" id="lobby-chat" tabindex="0" aria-live="polite" aria-relevant="additions">
        </div>
        <div class="chat-input">
            <textarea rows="2" placeholder="Escribe un mensaje..." id="lobby-chat-input-textarea" aria-label="Escribe un mensaje"></textarea>
            <button id="btn-send-chat" aria-label="Enviar mensaje">Enviar</button>
        </div>
    </section>
    </div>
  </div>
</div>

<div id="rules-modal" role="dialog" aria-modal="true" aria-labelledby="rules-modal-title">
<div class="modal-content">
    <span class="close-modal-btn">&times;</span>
    <h3 id="rules-modal-title">Reglas de Ludo y Parchís</h3>

    <h4 style="color: #c5a56a; border-bottom: 1px solid #c5a56a; padding-bottom: 5px; margin-top: 10px;">REGLAS DE LUDO</h4>
    
    <h4>Configuración de la Partida (Ludo)</h4>
    <ul>
        <li><strong>Creación:</strong> El Anfitrión define la Apuesta, la Moneda, su Color de asiento, el Número de Fichas (2, 3 o 4) y el Modo de Salida.</li>
        <li><strong>Modo de Salida:</strong>
            <ul style="margin-top: 5px;">
                <li><strong>Salida con Doble:</strong> Las fichas empiezan en la base y solo salen con un doble.</li>
                <li><strong>Salida Automática:</strong> Todas las fichas (2, 3 o 4) empiezan en la casilla de salida de su color.</li>
            </ul>
        </li>
        <li><strong>Inicio:</strong> Se necesitan 2 o más jugadores. El Anfitrión (creador de la sala) siempre tiene el primer turno.</li>
    </ul>

    <h4>Reglas de Dados y Turno (Ludo)</h4>
    <ul>
        <li><strong>Tirada:</strong> Se lanzan dos dados.</li>
        <li><strong>Sacar Fichas (Modo "Salida con Doble"):</strong>
            <ul style="margin-top: 5px;">
                <li>Si sacas un doble y tienes <strong>solo 1 ficha</strong> en base, esta sale. Debes mover el valor de uno de los dados y luego recibes un <strong>turno extra</strong>.</li>
                <li>Si sacas un doble y tienes <strong>2 o más fichas</strong> en base, todas salen. Tu turno extra se consume para <strong>volver a tirar</strong> inmediatamente.</li>
            </ul>
        </li>
        <li><strong>Turno Extra (Bono):</strong> Ganas un turno extra (vuelves a tirar) si:
            <ol style="margin-top: 5px;">
                <li>Matas a un oponente.</li>
                <li>Llegas con una ficha a la meta.</li>
                <li>Sacas un doble (y no tenías fichas en base).</li>
            </ol>
        </li>
        <li><strong>Pérdida de Turno:</strong> Pierdes tu turno si sacas un tiro normal (no doble) y no tienes ningún movimiento legal posible.</li>
    </ul>

    <h4>Reglas de Movimiento y Combate (Ludo)</h4>
    <ul>
        <li><strong>Movimiento:</strong> Puedes mover dos fichas (una por cada dado) o una sola ficha con la <strong>suma de ambos dados</strong>.</li>
        <li><strong>Casillas Seguras:</strong> Las casillas marcadas como seguras (incluyendo las de salida) te protegen. No puedes ser comido en ellas.</li>
        <li><strong>Matar:</strong> Si caes en una casilla (no segura) ocupada por un oponente, lo envías a su base y ganas un turno extra.</li>
        <li><strong>Matar al Salir:</strong> Si sales de la base y en tu casilla de salida hay un oponente, lo comes.</li>
        <li><strong>Meta:</strong> Debes sacar el número exacto para entrar a la meta. Al hacerlo, ganas un turno extra.</li>
        <li><strong>Apilamiento (Stacking):</strong> Puedes tener varias fichas (tuyas o de otros) en la misma casilla.</li>
    </ul>

    <h4>Penalizaciones (Falta) (Ludo)</h4>
    <ul>
        <li><strong>Falta por Matanza ObligatorIA:</strong>
            <ul style="margin-top: 5px;">
                <li>Si al inicio de tu turno tienes un movimiento que te permite matar a un oponente.</li>
                <li>Y eliges hacer un movimiento diferente (que no mata).</li>
                <li>Y después de ese movimiento, ya no te es posible realizar la matanza obligatoria.</li>
                <li><strong>Castigo:</strong> La ficha tuya que <strong>debía</strong> haber matado es enviada de vuelta a la base.</li>
            </ul>
        </li>
        <li><strong>Abandono:</strong> Si abandonas una partida en curso, tus fichas se retiran y se considera una falta.</li>
    </ul>

    <h4>Victoria y Fin de Partida (Ludo)</h4>
    <ul>
        <li><strong>Victoria:</strong> Ganas si todas tus fichas (según el número elegido) llegan a la meta. También ganas si todos los demás oponentes abandonan.</li>
        <li><strong>Comisión:</strong> Al finalizar la partida, el servidor deduce una <strong>comisión del 10%</strong> del bote total y entrega el resto al ganador.</li>
        <li><strong>Revancha:</strong> Al terminar, se activa la pantalla de revancha para los jugadores de la partida.</li>
    </ul>

    <hr style="border: 0; height: 1px; background: #c5a56a; margin: 30px 0;">

    <h4 style="color: #c5a56a; border-bottom: 1px solid #c5a56a; padding-bottom: 5px; margin-top: 10px;">REGLAS DE PARCHÍS</h4>
    
    <h4>Configuración de la Partida (Parchís)</h4>
    <ul>
        <li><strong>Modos de Juego:</strong> 2 Jugadores (1 vs 1), 4 Jugadores (Individual), o 4 Jugadores (Grupos 2 vs 2).</li>
        <li><strong>Orden de Turno:</strong> El orden de juego es fijo: Amarillo, luego Azul, luego Rojo, y finalmente Verde.</li>
    </ul>
    
    <h4>Reglas de Salida de Casa (Parchís)</h4>
    <ul>
        <li><strong>Sacar Ficha:</strong> Debes sacar un <strong>5</strong> (ya sea en un dado o como suma de ambos, ej. 2+3) para mover una ficha de la base a la casilla de salida.</li>
        <li><strong>Doble 5:</strong> Si sacas doble 5 (5-5), sacas dos fichas de la base (si tienes espacio).</li>
        <li><strong>Límite en Salida:</strong> La casilla de salida solo puede tener un máximo de 2 fichas (de cualquier color).</li>
        <li><strong>Matar al Salir:</strong> Si sales y en tu casilla de salida hay una ficha oponente, la "comes" (la envías a su base) y ganas un premio de 20 pasos.</li>
        <li><strong>Salida Bloqueada:</strong> No puedes sacar una ficha si tu casilla de salida ya está ocupada por 2 fichas *tuyas*.</li>
    </ul>

    <h4>Reglas de Dados y Penalizaciones (Parchís)</h4>
    <ul>
        <li><strong>Doble (Repetir):</strong> Si sacas un doble (ej. 4-4), mueves y vuelves a tirar.</li>
        <li><strong>Penalización (Tres Dobles):</strong> Si sacas <strong>tres dobles seguidos</strong>, la última ficha que moviste es castigada y vuelve a la base. (Excepción: no se aplica si la ficha ya está en la recta final de color).</li>
        <li><strong>Doble sin Fichas:</strong> Si sacas un doble (que no sea 5-5) pero no tienes fichas en el tablero, pierdes el doble pero vuelves a tirar.</li>
        <li><strong>Tiro Normal sin Fichas:</strong> Si sacas un tiro normal (sin 5) y no tienes fichas en el tablero, pierdes el turno.</li>
    </ul>

    <h4>Reglas de Movimiento y Combate (Parchís)</h4>
    <ul>
        <li><strong>Bloqueos (Barreras):</strong> Dos fichas (tuyas o mixtas) en la misma casilla (fuera de zona segura) forman una barrera. Ninguna ficha puede pasar por encima de una barrera.</li>
        <li><strong>Romper Barrera (Obligatorio):</strong> Si sacas un doble, estás <strong>obligado</strong> a usar uno de los dados para mover una de las fichas que forma tu barrera.</li>
        <li><strong>Puentes (Atajos):</strong> El tablero tiene puentes. Si caes en la entrada, saltas automáticamente a la salida del puente.</li>
        <li><strong>Llegada a Meta:</strong> Debes sacar el <strong>número exacto</strong> para entrar a la meta. No se permite rebotar.</li>
    </ul>

    <h4>Premios (Bonificaciones) (Parchís)</h4>
    <ul>
        <li><strong>Por Matar:</strong> Al "comer" a un oponente, ganas un movimiento de premio de <strong>20 pasos</strong>.</li>
        <li><strong>Por Llegar a Meta:</strong> Al meter una ficha en la meta, ganas un movimiento de premio de <strong>10 pasos</strong>.</li>
        <li>(Los premios son prioritarios y deben jugarse antes que los dados restantes).</li>
    </ul>
    
    <h4>Victoria y Fin de Partida (Parchís)</h4>
    <ul>
        <li><strong>Victoria Individual:</strong> Gana el primer jugador en llevar sus 4 fichas a la meta.</li>
        <li><strong>Victoria en Grupos (2 vs 2):</strong> El equipo gana cuando las <strong>8 fichas</strong> (las 4 tuyas y las 4 de tu compañero) están en sus metas.</li>
        <li><strong>Regla de Ayuda (Grupos):</strong> Si terminas de meter tus 4 fichas, en tus siguientes turnos pasarás a mover las fichas de tu compañero.</li>
        <li><strong>Victoria por Abandono (Grupos):</strong> Si un jugador de un equipo abandona, el equipo *contrario* gana la partida automáticamente.</li>
        <li><strong>Comisión:</strong> Se aplica la misma comisión del 10% sobre el bote total.</li>
    </ul>
    
    <button id="btn-close-rules-modal" class="secondary">Entendido</button>
</div>
</div>

<div id="create-room-modal" role="dialog" aria-modal="true" aria-labelledby="create-room-title" style="display: none;">
  <div class="modal-content">
    <span class="close-modal-btn">&times;</span>
    <h3 id="create-room-title">Crear Mesa</h3>

    <label for="game-type-select">Tipo de Juego:</label>
    <select id="game-type-select">
        <option value="ludo" selected>Ludo Tradicional</option>
        <option value="parchis">Parchís</option>
    </select>

    <label for="bet-input">Apuesta:</label>
    <input type="number" id="bet-input" min="1" value="10" />

    <label for="create-room-currency">Moneda de la Apuesta:</label>
    <select id="create-room-currency">
        <option value="EUR">Euro (€)</option>
        <option value="USD">Dólar Estadounidense ($)</option>
        <option value="COP">Peso Colombiano ($)</option>
    </select>

    <label for="host-color-select">Tu Color:</label>
    <select id="host-color-select">
        <option value="yellow" selected>Amarillo</option>
        <option value="green">Verde</option>
        <option value="red">Rojo</option>
        <option value="blue">Azul</option>
    </select>

    <div id="parchis-options-container" style="display: none;">
        <label for="parchis-mode-select">Modo de Juego (Parchís):</label>
        <select id="parchis-mode-select">
            <option value="2-individual" selected>2 Jugadores (1 vs 1)</option>
            <option value="4-individual">4 Jugadores (Individual)</option>
            <option value="4-groups">4 Jugadores (Grupos 2 vs 2)</option>
        </select>
    </div>

    <div id="ludo-options-container">
        <label for="piece-count-select">Número de Fichas:</label>
        <select id="piece-count-select">
            <option value="4" selected>4 Fichas</option>
            <option value="3">3 Fichas</option>
            <option value="2">2 Fichas</option>
        </select>

        <label for="auto-exit-select">Salida de Fichas:</label>
        <select id="auto-exit-select">
            <option value="double" selected>Salida con Doble (Tradicional)</option>
            <option value="auto">Salida Automática</option>
        </select>
    </div>
 
    <div class="error" id="create-room-error"></div>
    <button id="btn-create-room-confirm">Crear Mesa</button>
    <button id="btn-create-room-cancel" class="secondary">Volver</button>
    </div>
</div>

<div id="credit-modal" role="dialog" aria-modal="true" aria-labelledby="credit-modal-title">
  <div class="modal-content">
    <span class="close-modal-btn">&times;</span>
    <h3 id="credit-modal-title">Recargar/Retirar Créditos</h3>

    <div style="text-align: left; line-height: 1.5;">
        <h4 style="color: #c5a56a; margin-bottom: 5px; text-align: center; font-size: 1.1em;">PARA RECARGAS Y RETIROS</h4>
        <p style="text-align: center; margin-bottom: 15px;">
            Comunícate con el <strong>ADMINISTRADOR PRINCIPAL</strong>:
            <br>
            <strong><a id="whatsapp-link-primary" href="#" target="_blank" rel="noopener noreferrer">+34 665 530 984</a></strong>
            <br>
            <small style="font-size: 0.8em; color: #aaa;">
                Horario: 8:00 a 22:00 Madrid (GMT+2) <br>
                o de 8:00 a 16:00 Bogotá (GMT-5).
            </small>
        </p>
    </div>

    <div style="text-align: left; line-height: 1.5; border-top: 1px solid #555; padding-top: 15px; margin-top: 15px;">
        <h4 style="color: #c5a56a; margin-bottom: 5px; text-align: center; font-size: 1.1em;">SOLO PARA RECARGAS</h4>
        <p style="text-align: center; margin-bottom: 0;">
            Fuera de estos horarios, contacta al <strong>ADMIN SECUNDARIO</strong>:
            <br>
            <strong><a id="whatsapp-link-secondary" href="#" target="_blank" rel="noopener noreferrer">+57 300 428 0833</a></strong>
            <br>
            <small style="color: #aaa;">(Solo usuarios de Colombia)</small>
        </p>
    </div>

    <p style="font-size: 0.9em; color: #aaa; font-style: italic; margin-top: 25px; text-align: center;">
        Te responderemos lo más pronto posible, te agradecemos paciencia.
    </p>
    <button id="btn-close-credit-modal">Cerrar</button>
  </div>
</div>

<!-- ▼▼▼ NUEVO MODAL: OLVIDÉ MI CONTRASEÑA ▼▼▼ -->
<div id="forgot-password-modal" role="dialog" aria-modal="true" aria-labelledby="forgot-password-title" style="display: none;">
  <div class="modal-content">
    <span class="close-modal-btn">&times;</span>
    <h3 id="forgot-password-title">Recuperar Contraseña</h3>
    <p style="text-align: center; line-height: 1.6;">
        Para restablecer tu contraseña, por favor, ponte en contacto con uno de nuestros administradores a través de WhatsApp.
    </p>

    <div style="text-align: left; line-height: 1.5; border-top: 1px solid #555; padding-top: 15px; margin-top: 15px;">
        <h4 style="color: #c5a56a; margin-bottom: 5px; text-align: center; font-size: 1.1em;">ADMINISTRADOR PRINCIPAL</h4>
        <p style="text-align: center; margin-bottom: 15px;">
            <strong><a id="whatsapp-forgot-primary" href="https://wa.me/34665530984" target="_blank" rel="noopener noreferrer">+34 665 530 984</a></strong>
            <br>
            <small style="font-size: 0.8em; color: #aaa;">
                Horario: 8:00 a 22:00 Madrid (GMT+2) <br>
                o de 8:00 a 16:00 Bogotá (GMT-5).
            </small>
        </p>
    </div>

    <div style="text-align: left; line-height: 1.5; border-top: 1px solid #555; padding-top: 15px; margin-top: 15px;">
        <h4 style="color: #c5a56a; margin-bottom: 5px; text-align: center; font-size: 1.1em;">ADMIN SECUNDARIO</h4>
        <p style="text-align: center; margin-bottom: 0;">
            <strong><a id="whatsapp-forgot-secondary" href="https://wa.me/573004280833" target="_blank" rel="noopener noreferrer">+57 300 428 0833</a></strong>
        </p>
    </div>
    <button id="btn-close-forgot-modal" class="secondary">Volver</button>
  </div>
</div>
<!-- ▲▲▲ FIN DEL MODAL ▲▲▲ -->

<!-- ▼▼▼ NUEVO MODAL: CAMBIAR CONTRASEÑA ▼▼▼ -->
<div id="change-password-modal" role="dialog" aria-modal="true" aria-labelledby="change-password-title" style="display: none;">
  <div class="modal-content">
    <span class="close-modal-btn">&times;</span>
    <h3 id="change-password-title">Cambiar mi Contraseña</h3>

    <label for="current-password">Contraseña Actual:</label>
    <input type="password" id="current-password" required />

    <label for="new-password">Nueva Contraseña:</label>
    <input type="password" id="new-password" required />

    <label for="confirm-new-password">Confirmar Nueva Contraseña:</label>
    <input type="password" id="confirm-new-password" required />

    <div class="error" id="change-password-error"></div>
    <div class="success" id="change-password-success"></div>

    <button id="btn-confirm-change-password">Guardar Cambios</button>
    <button id="btn-cancel-change-password" class="secondary">Cancelar</button>
  </div>
</div>
<!-- ▲▲▲ FIN DEL MODAL ▲▲▲ -->

<div id="login-modal" role="dialog" aria-modal="true" aria-labelledby="login-modal-title">
  <div class="modal-content">
    <h2 class="panel-title">
      <span class="dice left-dice"></span>
      <span class="char" style="--i:1">L</span>
      <span class="char" style="--i:2">U</span>
      <span class="char" style="--i:3">D</span>
      <span class="char" style="--i:4">O</span>
      <span class="char" style="--i:5"> </span>
      <span class="char" style="--i:6">Y</span>
      <span class="char" style="--i:7"> </span>
      <span class="char" style="--i:8">P</span>
      <span class="char" style="--i:9">A</span>
      <span class="char" style="--i:10">R</span>
      <span class="char" style="--i:11">C</span>
      <span class="char" style="--i:12">H</span>
      <span class="char" style="--i:13">Í</span>
      <span class="char" style="--i:14">S</span>
      <span class="dice right-dice"></span>
    </h2>
    <h3 id="login-modal-title">Iniciar Sesión / Registrarse</h3>
    <label for="login-username">Nombre:</label>
    <input type="text" id="login-username" aria-required="true" />
    <label for="login-password">Contraseña:</label>
    <input type="password" id="login-password" aria-required="true" />
    <div class="error" id="login-error"></div>
    
    <a href="#" id="btn-forgot-password" style="display: block; text-align: right; font-size: 0.9em; color: var(--casino-gold); margin-top: 10px;">¿Olvidaste tu contraseña?</a>
    <button id="btn-login">Iniciar Sesión</button>
    <button id="btn-register" class="secondary">Registrarse</button>
  </div>
</div>

<div id="register-modal" role="dialog" aria-modal="true" aria-labelledby="register-modal-title">
  <div class="modal-content">
    <span class="close-modal-btn">&times;</span>
    <h2 class="panel-title">
      <span class="dice left-dice"></span>
      <span class="char" style="--i:1">L</span>
      <span class="char" style="--i:2">U</span>
      <span class="char" style="--i:3">D</span>
      <span class="char" style="--i:4">O</span>
      <span class="char" style="--i:5"> </span>
      <span class="char" style="--i:6">Y</span>
      <span class="char" style="--i:7"> </span>
      <span class="char" style="--i:8">P</span>
      <span class="char" style="--i:9">A</span>
      <span class="char" style="--i:10">R</span>
      <span class="char" style="--i:11">C</span>
      <span class="char" style="--i:12">H</span>
      <span class="char" style="--i:13">Í</span>
      <span class="char" style="--i:14">S</span>
      <span class="dice right-dice"></span>
    </h2>
    <h3 id="register-modal-title">Registro de Usuario</h3>
    <label for="register-name">Nombre:</label>
    <input type="text" id="register-name" aria-required="true" />

    <label for="register-country">País:</label>
    <select id="register-country" aria-required="true">
    <option value="">Selecciona un país</option>
    </select>

    <label for="register-whatsapp">WhatsApp:</label>
    <input type="text" id="register-whatsapp" aria-required="true" />

    <label for="register-currency">Moneda de tus créditos:</label>
    <select id="register-currency" aria-required="true">
        <option value="">Selecciona tu moneda</option>
        <option value="EUR">Euro (€)</option>
        <option value="USD">Dólar Estadounidense ($)</option>
        <option value="COP">Peso Colombiano ($)</option>
    </select>

    <label for="register-password">Contraseña:</label>
    <input type="password" id="register-password" aria-required="true" />

    <label for="register-confirm-password">Confirmar Contraseña:</label>
    <input type="password" id="register-confirm-password" aria-required="true" />

    <label>Selecciona un Avatar:</label>
    <div class="avatar-gallery" id="avatar-gallery">
      </div>
    <input type="file" id="register-avatar-upload" accept="image/*" style="display: none;" />

    <div class="avatar-preview-container" id="avatar-preview-container" style="display: none;">
        <img id="avatar-preview" class="avatar-preview" src="" alt="Vista previa del avatar">
    </div>

    <div class="error" id="register-error"></div>
    <div class="success" id="register-success"></div>

    <button id="btn-register-submit">Registrarse</button>
    <button id="btn-register-back" class="secondary">Volver al Login</button>
  </div>
</div>

<div id="avatar-crop-modal" role="dialog" aria-modal="true">
  <div class="modal-content">
    <span class="close-modal-btn">&times;</span>
    <h3 id="crop-modal-title">Ajusta tu Avatar</h3>
    <div id="crop-container">
      <div id="crop-image-wrapper">
          <img id="crop-image-preview" src="" alt="Previsualización para recortar">
      </div>
    </div>
    <div class="crop-controls">
        <label for="zoom-slider">Zoom:</label>
        <input type="range" id="zoom-slider" min="50" max="200" value="100">
    </div>
    <button id="btn-save-crop">Guardar Avatar</button>
    <button id="btn-cancel-crop" class="secondary">Cancelar</button>
  </div>
</div>

<div id="pwa-install-modal" class="overlay">
    <div class="modal-content">
        <span class="close-modal-btn">&times;</span>
        <h3>¡Mejora tu Experiencia de Juego!</h3>
        <p>
            Para disfrutar en <strong>pantalla completa</strong> y sin las barras del navegador, puedes añadir La 51 a tu pantalla de inicio.
        </p>

        <h4 class="pwa-subtitle">Android (Chrome)</h4>
        <ol class="pwa-instructions">
            <li>Toca el botón de menú (normalmente <strong>⋮</strong> en la esquina superior derecha).</li>
            <li>Selecciona la opción "<strong>Instalar aplicación</strong>" o "<strong>Añadir a pantalla de inicio</strong>".</li>
        </ol>

        <h4 class="pwa-subtitle">iPhone (Safari)</h4>
        <ol class="pwa-instructions">
            <li>Toca el icono de <strong>Compartir</strong> (un cuadrado con una flecha hacia arriba ).</li>
            <li>Busca y selecciona la opción "<strong>Añadir a pantalla de inicio</strong>".</li>
        </ol>

        <h4 class="pwa-subtitle pwa-alternative">
            Alternativa: Modo Escritorio
        </h4>
        <p class="pwa-instructions">
            Si prefieres no instalarla, puedes activar la "<strong>Vista de ordenador</strong>" o "<strong>Sitio de escritorio</strong>" en el menú de tu navegador (normalmente en <strong>⋮</strong> en Chrome o en <strong>aA</strong> en Safari). Esto puede mejorar la escala del juego en algunas pantallas.
        </p>

        <p class="pwa-optional-note">
            <strong>Es opcional.</strong> También puedes seguir jugando perfectamente desde el navegador.
        </p>

        <div class="button-group" style="display: flex; gap: 10px; margin-top: 20px;">
            <button id="btn-install-pwa" style="display: none; width: 100%;">⭐ Instalar Aplicación</button>
            <button id="btn-close-pwa-modal" style="width: 100%;" class="secondary">Aceptar</button>
        </div>
    </div>
</div>



<div id="simple-funds-modal" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 10005; align-items: center; justify-content: center;">
    <div style="background: #211e18; border: 2px solid #c5a56a; border-radius: 12px; padding: 25px; text-align: center; color: #e0d3b6; font-family: 'Georgia', serif; width: 90%; max-width: 380px; position: relative;">
        <span class="close-modal-btn">&times;</span>
        <h2 style="color: #ff4444; margin-top: 0; font-size: 1.5rem;">Fondos Insuficientes</h2>
        <p id="simple-funds-message" style="line-height: 1.6; font-size: 1.1em;">Mensaje de error aquí.</p>
        <button id="simple-funds-close-btn" style="margin-top: 20px; padding: 10px 30px; border-radius:8px; border: 2px solid #211e18; background: linear-gradient(to bottom, #d1b47a, #b59458); color: #211e18; font-weight: bold; cursor:pointer; font-size: 1rem;">Aceptar</button>
    </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script src="/ludo/ludolobby.js?v=2.9"></script>

<!-- ▼▼▼ COMENTADO: PWA INSTALLATION LISTENERS ▼▼▼
<script>
// Manejar instalación de PWA
let deferredPrompt; // <-- Hazla global
window.addEventListener('beforeinstallprompt', (e) => {
    console.log('PWA puede ser instalada');
    e.preventDefault();
    deferredPrompt = e;
});

// Manejar cuando la PWA se instala
window.addEventListener('appinstalled', (evt) => {
    console.log('PWA instalada exitosamente');
    deferredPrompt = null;
});
</script>
▲▲▲ FIN DEL BLOQUE COMENTADO ▲▲▲ -->


<div id="update-notification" style="display: none;">
    <span>¡Nueva versión disponible!</span>
    <button id="btn-reload-update">Actualizar</button>
</div>

</body>
</html>